



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://3os.org/general/synologyGeneral/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Synology - 3os.org</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#synology" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://3os.org" title="3os.org" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                3os.org
              </span>
              <span class="md-header-nav__topic">
                Synology
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/fire1ce/3os.org/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../linux/general/general/" title="Linux" class="md-tabs__link">
          Linux
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../macOS/macGeneral/" title="macOS" class="md-tabs__link">
          macOS
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://3os.org" title="3os.org" class="md-nav__button md-logo">
      
        <img src="../../images/logo.png" width="48" height="48">
      
    </a>
    3os.org
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/fire1ce/3os.org/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/general/general/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      macOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        macOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/macGeneral/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/brew/" title="Home Brew" class="md-nav__link">
      Home Brew
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-vm-tools-on-linux-vm" title="Installing VM Tools on Linux VM" class="md-nav__link">
    Installing VM Tools on Linux VM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automated-ssl-using-lets-encrypt-cloudflare-api-acmesh-script" title="Automated SSL Using Let's Encrypt, CloudFlare API, acme.sh Script" class="md-nav__link">
    Automated SSL Using Let's Encrypt, CloudFlare API, acme.sh Script
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automate-the-certificate-renewal" title="Automate The Certificate Renewal" class="md-nav__link">
    Automate The Certificate Renewal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#done" title="done" class="md-nav__link">
    done
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloudflare-ddns" title="CloudFlare DDNS" class="md-nav__link">
    CloudFlare DDNS
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fire1ce/3os.org/blob/master/docs/general/synologyGeneral.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="synology">Synology</h1>
<h2 id="installing-vm-tools-on-linux-vm">Installing VM Tools on Linux VM</h2>
<pre><code class="bash">sudo add-apt-repository universe
sudo apt-get install qemu-guest-agent
</code></pre>

<h2 id="automated-ssl-using-lets-encrypt-cloudflare-api-acmesh-script">Automated SSL Using Let's Encrypt, CloudFlare API, acme.sh Script</h2>
<p>ssh to synology nas</p>
<pre><code class="bash">wget https://github.com/Neilpang/acme.sh/archive/master.tar.gz
tar xvf master.tar.gz
cd acme.sh-master/
./acme.sh --install --nocron --home /usr/local/share/acme.sh
cd /usr/local/share/acme.sh
</code></pre>

<p>CF_Key= <code>your cloadflare Global API key</code>
CF_Email= <code>your cloudflare email account</code>
CERT_DOMAIN= <code>your domain managed on cloudflare dns</code>, you can use wilde card domain like <code>*.your-domain.tld</code></p>
<pre><code class="bash">export CF_Key=&quot;MY_SECRET_KEY_SUCH_SECRET&quot;
export CF_Email=&quot;&lt;myemail@example.com&gt;&quot;
export CERT_DOMAIN=&quot;your-domain.tld&quot;
export CERT_DNS=&quot;dns_cf&quot;
</code></pre>

<p>This Will Generate, Sing and install the Certificate</p>
<pre><code class="bash">./acme.sh --issue -d &quot;$CERT_DOMAIN&quot; --dns &quot;$CERT_DNS&quot; \
      --cert-file /usr/syno/etc/certificate/system/default/cert.pem \
      --key-file /usr/syno/etc/certificate/system/default/privkey.pem \
      --fullchain-file /usr/syno/etc/certificate/system/default/fullchain.pem \
      --reloadcmd &quot;/usr/syno/sbin/synoservicectl --reload nginx&quot; \
      --dnssleep 20
</code></pre>

<h3 id="automate-the-certificate-renewal">Automate The Certificate Renewal</h3>
<ul>
<li>Login to DSM</li>
<li>Go to Control Panel - Task Scheduler</li>
<li>Create - Scheduled Task - User-defined script</li>
<li>Name it something like that: <code>Lets-Encrypt Auto Renew</code></li>
<li>Run it under user root</li>
<li>At Schedule define it to run dayily at night (so you won't have expierd certificate)</li>
<li>at Task setting at this to the <code>user defined script</code> window:</li>
</ul>
<pre><code class="bash"> /usr/local/share/acme.sh/acme.sh --cron --home /usr/local/share/acme.sh/
</code></pre>

<ul>
<li>You can check if the script runs ok by ticking the <code>Send run details by mail</code> and provide your mail</li>
<li>Close the window</li>
<li>Select you newly created Task and Run it.</li>
<li>Check you email, you should get massage like that:</li>
</ul>
<pre><code class="qoute">Dear user,

Task Scheduler has completed a scheduled task.

Task: Task 8
Start time: Tue, 04 Sep 2018 19:54:09 GMT
Stop time: Tue, 04 Sep 2018 19:54:09 GMT
Current status: 0 (Normal)
Standard output/error:
[Tue Sep 4 19:54:09 IDT 2018] ===Starting cron===
[Tue Sep 4 19:54:09 IDT 2018] Renew: '*.your-domain.tld'
[Tue Sep 4 19:54:09 IDT 2018] Skip, Next renewal time is: Sat Nov 3 16:34:19 UTC 2018
[Tue Sep 4 19:54:09 IDT 2018] Add '--force' to force to renew.
[Tue Sep 4 19:54:09 IDT 2018] Skipped *.your-domain.tld
[Tue Sep 4 19:54:09 IDT 2018] ===End cron===
</code></pre>

<h3 id="done">done</h3>
<h2 id="cloudflare-ddns">CloudFlare DDNS</h2>
<p>based on this <a href="https://github.com/joshuaavalon/SynologyCloudflareDDNS">SynologyCloudflareDDNS</a></p>
<p>Ssh to synology nas as root
Download cloudflareddns.sh from this repository to /sbin/cloudflaredns.sh</p>
<pre><code class="bash">wget https://raw.githubusercontent.com/joshuaavalon/SynologyCloudflareDDNS/master/cloudflareddns.sh -O /sbin/cloudflaredns.sh
chmod +x /sbin/cloudflaredns.sh
</code></pre>

<p>Edit Synology's DDNS service config:</p>
<pre><code class="bash">vi /etc.defaults/ddns_provider.conf
</code></pre>

<p>Add this to the config</p>
<pre><code class="bash">[Cloudflare]
        modulepath=/sbin/cloudflaredns.sh
        queryurl=https://www.cloudflare.com/
</code></pre>

<p>Go to your cloudflare account
Go to your domain overview page and get the Zone ID.
Go to DNS zone and create A record you want to use for the DDNS with any IP address (just for the recored creation)
Go to your account setting page and get API Key.
Get record id using Cloudflare API.</p>
<p>Run this. You need to replace with [] with your parameter.</p>
<pre><code class="bash">curl -X GET &quot;https://api.cloudflare.com/client/v4/zones/[Zone ID]/dns_records&quot; \
     -H &quot;X-Auth-Email: [Email]&quot; \
     -H &quot;X-Auth-Key: [API Key]&quot; \
     -H &quot;Content-Type: application/json&quot;
</code></pre>

<p>You will Get information acout your Zone in the response. Look for <code>ID</code> Recored you created before.</p>
<pre><code class="bash">vi /sbin/cloudflaredns.sh
</code></pre>

<p>chnage <strong>RECID</strong>, <strong>ZONE_ID</strong> with the values you got before.</p>
<p>exmaple:</p>
<pre><code class="bash">__RECTYPE__=&quot;A&quot;
__RECID__=&quot;f3690c72ef24a964936f78760d62a3e1&quot;
__ZONE_ID__=&quot;2ffb4915izhe84e5974b0dec74fcd4f2&quot;
__TTL__=&quot;1&quot;
__PROXY__=&quot;true&quot;
</code></pre>

<p><strong><code>__PROXY__ true/false depandes on your usage</code></strong></p>
<p>Login to your DSM
Go to Control Panel &gt; External Access &gt; DDNS &gt; Add
Select Cloudflare as service provider. Enter your domain as hostname, your Cloudflare account as Username/Email, and API key as Password/Key</p>
<p>At the console:</p>
<pre><code class="bash">tail -f /var/log/cloudflareddns.log
</code></pre>

<p>Click Test Connection
You shoud see somthing like that at the console:</p>
<pre><code class="bash">cloudflaredns.sh (7): Updating with 185.185.185.185...
cloudflaredns.sh (7): Status: good
</code></pre>
                
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://3os.org/general/synologyGeneral/";
      this.page.identifier =
        "/general/synologyGeneral/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//3os.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>